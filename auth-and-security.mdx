---
title: "AutenticaÃ§Ã£o & SeguranÃ§a"
description: "Como funciona a autenticaÃ§Ã£o e proteÃ§Ã£o de dados na Social API"
---

A Social API Ã© **interna**. Isso significa que toda requisiÃ§Ã£o precisa ser autenticada â€” exceto `/health` e `/docs/`.

A boa notÃ­cia? Ã‰ simples. Dois headers resolvem tudo.

---

# **Headers de autenticaÃ§Ã£o**

| Header | Tipo | O que faz |
| ------ | ---- | --------- |
| `X-Internal-Secret` | **ObrigatÃ³rio** | Chave de autenticaÃ§Ã£o. Sem ela, nada funciona. |
| `X-Enterprise-Id` | **Recomendado** | UUID do tenant. Isola os dados por empresa. |
| `X-User-Id` | Opcional | UUID do usuÃ¡rio. Ãštil pra auditoria. |

---

# **Exemplo prÃ¡tico**

```bash
curl https://social-api.appconty.com/accounts \
  -H "X-Internal-Secret: sua-chave-secreta" \
  -H "X-Enterprise-Id: uuid-da-enterprise"
```

Simples assim. Dois headers e vocÃª tÃ¡ autenticado.

---

# **X-Internal-Secret**

Ã‰ a chave mestra. Sem ela, vocÃª recebe:

```json
{
  "code": "ERR_UNAUTHORIZED",
  "message": "invalid or missing X-Internal-Secret"
}
```

### Como gerar uma chave segura

```bash
openssl rand -base64 32
```

### No seu .env

```env
INTERNAL_SECRET=sua-chave-ultra-secreta-aqui
```

<Tip>
Sempre gere uma chave nova ao trocar de ambiente. Nunca reutilize entre dev/staging/prod.
</Tip>

---

# **X-Enterprise-Id (Multi-tenant)**

A API foi construÃ­da pra servir mÃºltiplas empresas ao mesmo tempo. O `X-Enterprise-Id` garante que:

* âœ… Dados ficam isolados por tenant
* âœ… Uma empresa nunca vÃª dados de outra
* âœ… Rate limits sÃ£o individuais

Sem esse header, as requisiÃ§Ãµes funcionam, mas **nÃ£o retornam dados de nenhuma conta** â€” porque nÃ£o sabe de qual tenant buscar.

---

# **X-User-Id (Opcional)**

Se vocÃª quer rastrear quem fez o quÃª:

```bash
-H "X-User-Id: uuid-do-usuario"
```

Ãštil pra:

* Saber quem pediu uma sincronizaÃ§Ã£o
* Auditoria de operaÃ§Ãµes
* Logs mais detalhados

---

# **Endpoints pÃºblicos**

Dois endpoints **nÃ£o precisam** de autenticaÃ§Ã£o:

| Rota | Pra quÃª serve |
| ---- | ------------- |
| `GET /health` | Healthcheck (retorna `OK` ou `DB_UNHEALTHY`) |
| `GET /docs/` | Swagger UI |

```bash
curl https://social-api.appconty.com/health
# Resposta: OK (200) ou DB_UNHEALTHY (503)
```

---

# **Erros de autenticaÃ§Ã£o**

<AccordionGroup>
  <Accordion title="âŒ Secret faltando ou invÃ¡lido">
    ```json
    { "code": "ERR_UNAUTHORIZED", "message": "invalid or missing X-Internal-Secret" }
    ```
    
    **SoluÃ§Ã£o:** Adicione o header com a chave correta.
  </Accordion>
  
  <Accordion title="âŒ Enterprise ID invÃ¡lido">
    ```json
    { "code": "ERR_INVALID_REQUEST", "message": "invalid X-Enterprise-Id (must be uuid)" }
    ```
    
    **SoluÃ§Ã£o:** Use um UUID v4 vÃ¡lido.
  </Accordion>
</AccordionGroup>

---

# **SeguranÃ§a em produÃ§Ã£o**

No Cloud Run, a API usa:

* ğŸ” **GCP Secret Manager** â€” secrets nunca ficam em cÃ³digo
* ğŸ”’ **HTTPS obrigatÃ³rio** â€” trÃ¡fego sempre criptografado
* ğŸ›¡ï¸ **IAM** â€” acesso restrito aos secrets

---

# **Resumo**

```
X-Internal-Secret â†’ autenticaÃ§Ã£o (obrigatÃ³rio)
X-Enterprise-Id   â†’ isolamento de dados (recomendado)
X-User-Id         â†’ rastreabilidade (opcional)
```

TrÃªs headers. SeguranÃ§a completa. Sem complicaÃ§Ã£o.
